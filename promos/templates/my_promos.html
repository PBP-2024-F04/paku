{% extends 'base_navbar.html' %}

{% block content %}
<h1>My Promo</h1>

<a href="{% url 'promos:add_promo' %}" class="btn btn-primary">Tambah Promo Baru</a>

<hr>

{% if promos %}
    {% for promo in promos %}
    <div class="promo-card">
        <h3><strong>{{ promo.promo_title }}</strong></h3>
        <p><strong>Resto:</strong> {{ promo.restaurant_name }}</p>
        <p><strong>Deskripsi:</strong> {{ promo.promo_description }}</p>
        <p><strong>Berlaku hingga:</strong> {{ promo.batas_penggunaan }}</p>
        <div class="button-group">
            <button onclick="window.location.href='{% url 'promos:update_promo' promo.id %}'" class="btn btn-warning btn-sm">Update</button>
            <button onclick="deletePromo('{{ promo.id }}')" class="btn btn-danger btn-sm">Delete</button>
        </div>
        <hr>
    </div>
    {% endfor %}
{% else %}
    <p>Belum ada promo yang kamu tambahkan!</p>
{% endif %}

<script>
    function deletePromo(promoId) {
        if (confirm('Apakah Anda yakin ingin menghapus promo ini?')) {
            fetch(`/promos/delete_promo/${promoId}/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}',
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    alert('Promo berhasil dihapus!');
                    window.location.reload();
                } else {
                    alert('Gagal menghapus promo: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Terjadi kesalahan saat menghapus promo');
            });
        }
    }
</script>

<style>
    .button-group {
        margin-top: 10px;
    }
    .button-group .btn {
        margin-right: 5px;
    }
</style>

{% endblock %}