{% extends 'base_navbar.html' %}

{% block content %}
<h1 class="text-4xl mt-4 text-center"><strong>My Products</strong></h1>
<a href="{% url 'products:create_product' %}" class="text-center block mt-8 mx-auto bg-sage-dark text-white font-bold py-2 px-4 hover:bg-sage-darker hover:text-white w-fit">
  Tambah Produk Baru
</a>

{% if user.role == 'Foodie' %}
{% else %}
  {% if not products %}
    <p class="text-xl my-6 mt-6 font-semibold text-sage-darker text-center">{{ empty_message }}</p>
  {% else %}
    <div class="p-6 my-6 m-4 w-full mx-auto flex flex-wrap justify-center gap-6 p-4">
  {% for product in products %}
  <div onclick="window.location.href='{% url 'products:view_product' product.pk %}'" class="product-card shadow-lg p-6 w-80 flex flex-col justify-center gap-4 rounded-lg cursor-pointer transform transition duration-500 hover:shadow-2xl hover:-translate-y-1">
      <div class="absolute top-5 left-5 flex space-x-2 z-10 font-semibold text-sm">
        <p>{{ product.category }}</p>
      </div>
      <div class="absolute top-3 right-3 flex space-x-2 z-10">
        <button onclick="event.stopPropagation(); window.location.href='{% url 'products:edit_product' product.pk %}'" class="w-8 h-8 bg-yellow hover:bg-yellow-dark text-white rounded-full flex items-center justify-center focus:outline-none transition duration-300">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
            <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" />
          </svg>
        </button>
        <button onclick="event.stopPropagation(); deleteProduct('{{ product.pk }}')" class="w-8 h-8 bg-red hover:bg-red-dark text-white rounded-full flex items-center justify-center focus:outline-none transition duration-300">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
      <h3 class="text-2xl mt-4 font-semibold text-grey text-center"><strong>{{ product.product_name }}</strong></h3>
      <p class="text-grey mt-2">{{ product.description }}</p>
      <p class="text-peach-dark mt-2"><strong>Harga: Rp{{ product.price }},00</strong></p>
    </div>
  {% endfor %}
  </div>
  {% endif %}
{% endif %}

<script>
  function deleteProduct(productId) {
      if (confirm('Apakah Anda yakin ingin menghapus produk ini?')) {
          fetch(`/products/me/${productId}/delete-product/`, {
              method: 'POST',
              headers: {
                  'X-CSRFToken': '{{ csrf_token }}',
                  'Content-Type': 'application/json',
              }
          })
          .then(response => response.json())
          .then(data => {
              if (data.status === 'success') {
                  alert('Produk berhasil dihapus!');
                  window.location.reload();
              } else {
                  alert('Gagal menghapus produk: ' + data.message);
              }
          })
          .catch(error => {
              console.error('Error:', error);
              alert('Terjadi kesalahan saat menghapus produk');
          });
      }
  }
</script>
<style>
  .product-card {
    position: relative;
    transition: box-shadow 0.3s, transform 0.3s;
  }
</style>
{% endblock content %}
