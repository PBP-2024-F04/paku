{% extends 'base_navbar.html' %}

{% block content %}
<div>
	<p><strong>{{ post.user.foodieprofile.full_name }}</strong> wrote:</p>
	<p>{{ post.text }}</p>
</div>

<hr>

<div id="comment-container">
</div>

<form id="comment-form">
	<input type="text" name="text" autocomplete="off" />
	<button type="submit">Create Comment</button>
</form>

<script>
function getComments() {
	return fetch("{% url 'timeline:get_comments' post.id %}").then(res => res.json());
}

async function refreshComments() {
	const commentContainer = document.getElementById('comment-container');
	const comments = await getComments();

	let innerHTML = '';

	for (const comment of comments) {
		innerHTML += `
			<div>
				<p><strong>${comment.user_fullname}</strong> @${comment.username} replied:</p>
				<p>${comment.text}</p>
			</div>
		`;
	}

	commentContainer.innerHTML = innerHTML;
}

document.getElementById('comment-form').addEventListener('submit', (e) => {
	e.preventDefault();

	fetch("{% url 'timeline:create_comment' post.id %}", {
		method: 'POST',
		body: new FormData(e.target),
	}).then(() => {
		refreshComments();
		e.target.reset();
	});
})

refreshComments();
</script>

{% endblock content %}
